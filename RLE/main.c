#include "../fc.h"

extern const uint8_t pal[];
extern const uint8_t rle_nt[];

const uint8_t rle_nt2[] = {
 RLE_TAG, 
 0x00,RLE_COUNT(0x10),                      //!< 0x00 が 0x10 個
 0x80,RLE_COUNT(0x02),                      //!< 0x80 が 0x02 個
 0x00,0x80,0x00,0x80,0x00,RLE_COUNT(0x1f),  //!< 0x00,0x80,0x00,0x80,0x00 が 0x1f 個
 0x80,0x80,0x00,RLE_COUNT(0x07),            //!< 0x80,0x80,0x00 が 0x07 個
 0x41,0x4e,0x00,0x38,0x42,0x49,0x54,0x57,0x4f,0x52,0x4b,0x53,0x48,0x4f,0x50,0x00,0x47,0x41,0x4d,0x45,0x00,RLE_COUNT(0x02),
 0x80,0x00,RLE_COUNT(0x1d),
 0x7f,0x7f,0x80,0x00,RLE_COUNT(0x1c),
 0x8f,0x7f,0x80,0x00,RLE_COUNT(0x06),
 0x80,RLE_COUNT(0x0b),
 0x00,RLE_COUNT(0x09),
 0x80,0x8f,0x80,0x00,RLE_COUNT(0x09),
 0x7f,RLE_COUNT(0x02),
 0x80,RLE_COUNT(0x02),
 0x7f,0x7f,0x80,RLE_COUNT(0x02),
 0x00,0xba,0xbb,0x00,RLE_COUNT(0x02),
 0x80,0x00,0x8f,0x80,RLE_COUNT(0x03),
 0x00,0x80,0x80,0x00,RLE_COUNT(0x03),
 0x7f,0x7f,0x8f,0x8f,0x7f,0x7f,0x80,0x7f,0x7f,0x80,RLE_COUNT(0x03),
 0xbe,0xbf,0x80,0x00,0x00,0x80,RLE_COUNT(0x04),
 0x00,0x80,RLE_COUNT(0x03),
 0x00,RLE_COUNT(0x02),
 0x7f,0x7f,0x8f,0x80,0x80,0x8f,0x8f,0x00,0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x00,0x7f,0x00,0x80,0x80,0x7f,0x7f,0x80,0x7f,0x00,0x80,0x00,0x00,0x7f,RLE_COUNT(0x02),
 0x80,RLE_COUNT(0x02),
 0x00,RLE_COUNT(0x02),
 0x7f,0x7f,0x80,0x8f,0x8f,0x80,0x7f,RLE_COUNT(0x06),
 0x80,0x80,0x7f,RLE_COUNT(0x02),
 0x8f,0x80,0x80,0x00,0x00,0x7f,RLE_COUNT(0x02),
 0x80,RLE_COUNT(0x02),
 0x00,RLE_COUNT(0x02),
 0x7f,0x7f,0x80,0x80,0x00,0x80,0x7f,0x7f,0x8f,0x7f,0x8f,0x7f,0x7f,0x80,0x80,0x7f,0x7f,0x8f,0x80,0x80,0x00,RLE_COUNT(0x02),
 0x7f,RLE_COUNT(0x02),
 0x80,RLE_COUNT(0x02),
 0x00,RLE_COUNT(0x02),
 0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x80,0x7f,0x7f,0x80,0x80,0x7f,0x7f,0x80,RLE_COUNT(0x02),
 0x00,RLE_COUNT(0x02),
 0x7f,RLE_COUNT(0x02),
 0x80,RLE_COUNT(0x02),
 0x00,RLE_COUNT(0x02),
 0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x80,0x7f,0x7f,0x80,0x80,0x7f,0x7f,0x80,0x80,0x00,RLE_COUNT(0x03),
 0x7f,RLE_COUNT(0x02),
 0x00,0x80,RLE_COUNT(0x04),
 0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x80,0x7f,0x7f,0x80,0x80,0x7f,0x7f,0x80,0x80,0x00,RLE_COUNT(0x03),
 0x8f,0x7f,0x7f,0x00,0x80,RLE_COUNT(0x04),
 0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x7f,0x80,0x7f,0x80,0x7f,0x7f,0x80,0x80,0x7f,0x7f,0x80,0x80,0x00,RLE_COUNT(0x04),
 0x8f,0x7f,0x7f,0x00,0x00,0x7f,0x7f,0x80,0x8f,0x8f,0x80,0x8f,0x8f,0x80,0x8f,0x8f,0x80,0x8f,0x00,0x8f,0x8f,0x80,0x00,0x8f,0x8f,0x80,0x80,0x00,RLE_COUNT(0x05),
 0x8f,0x7f,RLE_COUNT(0x03),
 0x8f,0x00,RLE_COUNT(0x05),
 0x90,0x80,0x80,0x00,0x80,0x00,0x80,0x00,0x00,0x80,RLE_COUNT(0x02),
 0x00,0x80,0x00,RLE_COUNT(0x06),
 0x8f,RLE_COUNT(0x03),
 0x00,RLE_COUNT(0x02),
 0xa1,RLE_COUNT(0x13),
 0x00,RLE_COUNT(0x0a),
 0xac,0xa1,RLE_COUNT(0x13),
 0x00,RLE_COUNT(0x09),
 0xac,0xac,0x20,RLE_COUNT(0x03),
 0x00,RLE_COUNT(0x18),
 0xac,0xac,0x00,0x06,RLE_COUNT(0x12),
 0x00,RLE_COUNT(0x08),
 0xac,0xac,0x00,0x00,0x06,0x00,RLE_COUNT(0x10),
 0x06,0x00,RLE_COUNT(0x07),
 0xac,0xac,0x00,RLE_COUNT(0x02),
 0x06,0x00,0x1f,0x00,0x50,0x52,0x45,0x53,0x53,0x00,0x53,0x54,0x41,0x52,0x54,0x00,0x1e,0x00,0x06,0x00,RLE_COUNT(0x06),
 0xac,0xac,0x00,RLE_COUNT(0x03),
 0x06,0x00,RLE_COUNT(0x10),
 0x06,0x00,RLE_COUNT(0x05),
 0xac,0xac,0x00,RLE_COUNT(0x04),
 0x06,RLE_COUNT(0x12),
 0x00,RLE_COUNT(0x04),
 0xac,0xac,0x00,RLE_COUNT(0x1c),
 0xac,0xac,0x00,RLE_COUNT(0x1c),
 0xac,0xac,0x00,RLE_COUNT(0x1c),
 0xac,0xac,0x00,RLE_COUNT(0x1c),
 0xac,0xac,0x00,RLE_COUNT(0x1d),
 0x80,0xa0,RLE_COUNT(0x03),
 0x20,0x00,RLE_COUNT(0x02),
 0xa0,0x20,0x00,0xf0,0x00,RLE_COUNT(0x02),
 0x88,0x22,0x02,0x00,RLE_COUNT(0x04),
 0x88,0x22,0x20,0x00,RLE_COUNT(0x05),
 0x0a,0x02,0x00,RLE_COUNT(0x07),
 0xd5,0x55,RLE_COUNT(0x02),
 0x75,0x00,RLE_COUNT(0x02),
 0x55,RLE_COUNT(0x04),
 0x00,RLE_COUNT(0x02),
 0x05,RLE_COUNT(0x03),
 0x05,RLE_COUNT(0x00),
};

void nmi() { }

void main() 
{
  uint8_t Fade = 0;

  //!< パレット
  {
    pal_bg((const char*)pal);
  }

  //!< ネームテーブル (RLEフォーマット)
  {
    vram_adr(NAMETABLE_A);
    vram_unrle(rle_nt);
    //vram_unrle(rle_nt2);
  }

  pal_bright(Fade >> 4);

  //!< PPU 制御
  {
    ppu_mask(MASK_BG | MASK_SPR);

    ppu_on_all();
  }

  //!< NMI コールバック
  nmi_set_callback(nmi);

  //!< VRAM バッファ
  {
    VramBufferSize = 64;
    VRAMBUF_CLEAR;
    //!< VRAM バッファのアドレスを知らせておく
    set_vram_update(VramBuffer);
  }

  while (1) {
    //!< フェード [0, 8]
    {
      Fade = MIN(++Fade, 64);
      pal_bright(Fade >> 4);
    }

    //!< PAL, NTSC を問わず、次のフレームまでウエイト
    ppu_wait_nmi();
  }

  ppu_off();
}

	
	